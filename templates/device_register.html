<!DOCTYPE html>
<html>
<head>
    <title>Register Device</title>
</head>
<body>

    <h2>Device Registration</h2>

    <p>Your account is approved. Now register your device.</p>

    <form id="deviceForm">

        <input type="hidden" id="userAgent">
        <input type="hidden" id="platform">
        <input type="hidden" id="cpuThreads">
        <input type="hidden" id="screen">
        <input type="hidden" id="timezone">

        <button type="submit">Register Device</button>

    </form>

    <script>
        // Collect fingerprint details
        document.getElementById("userAgent").value = navigator.userAgent;
        document.getElementById("platform").value = navigator.platform;
        document.getElementById("cpuThreads").value = navigator.hardwareConcurrency || 1;
        document.getElementById("screen").value = `${screen.width}x${screen.height}`;
        document.getElementById("timezone").value = Intl.DateTimeFormat().resolvedOptions().timeZone;

        document.getElementById("deviceForm").addEventListener("submit", async function(e) {
            e.preventDefault();

            const payload = {
                userAgent: document.getElementById("userAgent").value,
                platform: document.getElementById("platform").value,
                cpuThreads: document.getElementById("cpuThreads").value,
                screen: document.getElementById("screen").value,
                timezone: document.getElementById("timezone").value
            };

            const res = await fetch("/device/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await res.json();
            alert("Device registered!");
            window.location.href = "/login";
        });
    </script>

</body>
</html>
